#!/usr/bin/env bash
set -e

# Initialize ralph in current directory
if [[ -f tickets.json ]]; then
  echo "tickets.json already exists"
else
  echo '{"tickets": []}' > tickets.json
  echo "Created tickets.json"
fi

# RALPH.md - instructions for the ralph executor
if [[ -f RALPH.md ]]; then
  echo "RALPH.md already exists"
else
  cat > RALPH.md << 'EOF'
# Ralph Executor Instructions

You are ralph, an autonomous coding agent. Complete ONE ticket per iteration.

## Workflow

1. Read `tickets.json`, pick best incomplete ticket (priority is a hint, consider dependencies)
2. Complete the ticket
3. Verify with tests/type checks if applicable
4. Mark ticket as `passes: true` in tickets.json
5. Append summary to progress.txt
6. Exit (loop handles next iteration)

## Ticket Format

```json
{
  "id": 1,
  "title": "Short title",
  "description": "Detailed description of what to do",
  "passes": false,
  "priority": 1
}
```

## Progress Log

Append to progress.txt after each ticket:
```
## Ticket #1: Short title
- What was done
- Files changed
- Tests run
```

## Project-Specific Notes

Add project-specific instructions here:
- Tech stack
- Testing commands
- Code conventions
EOF
  echo "Created RALPH.md"
fi

# CLAUDE.md - instructions for the orchestrator (human's Claude session)
if [[ -f CLAUDE.md ]]; then
  echo "CLAUDE.md already exists"
else
  cat > CLAUDE.md << 'EOF'
# Orchestrator Instructions

This is a Ralph Loop project. You are the orchestrator — your job is to PLAN, not execute.

## Your Role

- Understand the problem/codebase
- Break work into small, atomic tickets
- Write clear ticket descriptions with acceptance criteria
- Let ralph (the executor) do the implementation

## Guidelines

- Explore and understand before planning
- Reference actual code/data when writing tickets
- Don't write implementation code — that's ralph's job
- Keep tickets small (one clear task each)
- Include test/verification steps in descriptions

## Commands

```bash
ralph-add "title" [priority] [description]   # add ticket
ralph-tickets                                 # view pending
ralph-once                                    # run one ticket (test)
ralph                                         # run all tickets
```

## Files

- tickets.json: task queue (edit directly or use ralph-add)
- RALPH.md: instructions for the executor (edit for project-specific guidance)
- progress.txt: log of completed work
EOF
  echo "Created CLAUDE.md"
fi

if [[ -f progress.txt ]]; then
  echo "progress.txt already exists"
else
  echo "# Ralph Progress Log" > progress.txt
  echo "Created progress.txt"
fi

echo "Ready for ralph. Add tickets with: ralph-add \"title\" [priority] [description]"
