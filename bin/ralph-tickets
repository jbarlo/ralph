#!/usr/bin/env bash
set -e

if [[ ! -f tickets.json ]]; then
  echo "No tickets.json found."
  exit 1
fi

MODE="${1:-pending}"

case "$MODE" in
  pending|p)
    jq -r '.tickets[] | select(.status == "pending" or .status == "in_progress") | "[\(.priority)] #\(.id): \(.title)" + (if .status == "in_progress" then " (in progress)" else "" end) + (if .description != "" then "\n    " + .description else "" end)' tickets.json
    ;;
  done|d)
    jq -r '.tickets[] | select(.status == "completed") | "#\(.id): \(.title)"' tickets.json
    ;;
  failed|f)
    jq -r '.tickets[] | select(.status == "failed") | "#\(.id): \(.title)"' tickets.json
    ;;
  all|a)
    jq -r '.tickets[] | "[\(.status | .[0:1])] #\(.id): \(.title)"' tickets.json
    ;;
  *)
    echo "Usage: ralph-tickets [pending|done|failed|all]"
    exit 1
    ;;
esac
