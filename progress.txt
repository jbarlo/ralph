# Ralph Progress Log

Append-only log of completed work. Each iteration adds to this file.

---

## Ticket #1: Create hooks.d directory structure
- Updated bin/ralph-init to create hooks.d/ directory with subdirectories: on-start/, on-complete/, on-error/
- Each subdirectory contains a .gitkeep file for git tracking
- Idempotent: skips creation if hooks.d/ already exists
- Files changed: bin/ralph-init
- Tests: verified directory structure created correctly, verified idempotence

## Ticket #2: Create ralph-hooks executor script
- Created bin/ralph-hooks script to execute lifecycle hooks
- Finds all executable files in hooks.d/<event>/ directory
- Executes hooks in lexicographic order (01-first, 02-second, etc.)
- Passes JSON context via stdin, RALPH_HOOK_EVENT, and RALPH_HOOK_CONTEXT env vars
- Continues on failure, collects errors, reports at end
- Exits 0 if no hooks or all succeed, exits 1 if any fail
- Files changed: bin/ralph-hooks (new)
- Tests: verified with test hooks for success, failure, and continuation behavior

## Ticket #3: Implement on-start hook in ralph/ralph-once
- Added on-start hook call to bin/ralph before docker container starts
- Added on-start hook call to bin/ralph-once before docker container starts
- Hook runs on host (not in container) so hooks can access host tools
- JSON payload: {event: "start", ticket: <current-ticket>, timestamp: <iso8601>}
- Gets highest priority pending/in_progress ticket from tickets.json
- Hook failures don't abort ralph (continues with || true)
- Files changed: bin/ralph, bin/ralph-once
- Tests: verified JSON payload generation, tested with temporary hook script

## Ticket #4: Implement on-complete hook
- Added on-complete hook call to bin/ralph and bin/ralph-once after docker exits
- Hook runs on host after docker exits successfully (exit code 0)
- Checks if ticket status changed to "completed" before triggering hook
- JSON payload: {event: "complete", ticket: <completed-ticket>, summary: <last-progress-entry>, timestamp: <iso8601>}
- Summary extracted from progress.txt using awk (last ## Ticket entry)
- Hook failures don't abort ralph (continues with || true)
- Files changed: bin/ralph, bin/ralph-once
- Tests: verified bash syntax, tested jq/awk commands, tested hook invocation with ralph-hooks

## Ticket #5: Implement on-error hook
- Added on-error hook call to bin/ralph and bin/ralph-once
- Hook triggers when: docker exits non-zero OR ticket wasn't marked completed
- Refactored hook logic to use if/elif for on-complete vs on-error (mutually exclusive)
- JSON payload: {event: "error", ticket: <ticket-json>, exit_code: <code>, timestamp: <iso8601>}
- Uses TICKET_AFTER if available, falls back to TICKET_BEFORE
- Hook failures don't abort ralph (continues with || true)
- Files changed: bin/ralph, bin/ralph-once
- Tests: verified bash syntax, tested JSON payload generation, tested ralph-hooks invocation

## Ticket #6: Add example hook scripts
- Created hooks.d/on-complete/log-completion.sh.example: logs completed tickets to ralph-completed.log
- Created hooks.d/on-error/notify.sh.example: sends desktop notification on failure (notify-send/osascript/fallback)
- Both hooks include detailed comments: how to enable, payload structure, parsing examples
- Not executable by default (.example extension), require copy + chmod +x to enable
- Files changed: hooks.d/on-complete/log-completion.sh.example, hooks.d/on-error/notify.sh.example
- Tests: verified bash syntax, tested both hooks with sample JSON payloads

## Ticket #7: Document hooks.d in ralph-help
- Added new HOOKS section to bin/ralph-help documentation
- Documents directory structure (hooks.d/on-start, on-complete, on-error)
- Explains how to enable hooks (create executable script, lexicographic ordering)
- Documents hook context (stdin, RALPH_HOOK_CONTEXT, RALPH_HOOK_EVENT env vars)
- Shows payload format for each event type with JSON examples
- Lists use cases: logging, notifications, external task trackers, CI/CD
- Mentions ralph-hooks command for manual hook execution
- Files changed: bin/ralph-help
- Tests: verified ralph-help output renders correctly

